<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Card Scraper Admin</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h2 {
            color: #555;
            margin-top: 0;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .danger {
            background-color: #f44336;
        }
        .danger:hover {
            background-color: #da190b;
        }
        .warning {
            background-color: #ff9800;
        }
        .warning:hover {
            background-color: #e68900;
        }
        .info {
            background-color: #2196F3;
        }
        .info:hover {
            background-color: #0b7dda;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Pokemon Card Java Scraper Admin</h1>
        
        <div class="grid">
            <div class="section">
                <h2>üìä Status</h2>
                <div id="status" class="status info">Loading status...</div>
                <button onclick="refreshStatus()" class="info">Refresh Status</button>
            </div>
            
            <div class="section">
                <h2>üîß Java Scraper Controls</h2>
                <button onclick="initScraper()" class="info">Initialize Java Scraper</button>
                <button onclick="closeScraper()" class="danger">Close Java Scraper</button>
                <button onclick="refreshStatus()" class="info">Refresh Status</button>
            </div>
        </div>

        <div class="section">
            <h2>üéØ Scrape Specific Set</h2>
            <div class="form-group">
                <label for="setSelect">Select Set:</label>
                <select id="setSelect">
                    <option value="">Loading sets...</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="isJapanese"> Japanese Set
                </label>
            </div>
            <button onclick="scrapeSet()" class="warning">Scrape Selected Set</button>
        </div>

        <div class="section">
            <h2>üöÄ Bulk Operations</h2>
            <button onclick="scrapeAllSets()" class="warning">Scrape All Sets</button>
            <button onclick="syncData()" class="info">Sync Data to Users</button>
        </div>

        <div class="section">
            <h2>üìã Available Sets</h2>
            <div class="form-group">
                <label for="setTypeFilter">Filter by Type:</label>
                <select id="setTypeFilter" onchange="loadSets()">
                    <option value="all">All Sets</option>
                    <option value="english">English Only</option>
                    <option value="japanese">Japanese Only</option>
                </select>
            </div>
            <div id="setsList" class="log">Loading sets...</div>
        </div>

        <div class="section">
            <h2>üìù Activity Log</h2>
            <div id="log" class="log">Ready to start scraping...</div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.className = type;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(status) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${status.isScraping ? 'warning' : 'success'}`;
            statusDiv.innerHTML = `
                <strong>Java Scraper Status:</strong><br>
                Type: ${status.type || 'Unknown'}<br>
                Initialized: ${status.isInitialized ? '‚úÖ Yes' : '‚ùå No'}<br>
                Currently Scraping: ${status.isScraping ? 'üîÑ Yes' : '‚úÖ No'}<br>
                Last Updated: ${new Date(status.timestamp).toLocaleString()}
            `;
        }

        async function refreshStatus() {
            try {
                const response = await fetch(`${API_BASE}/scraper/status`);
                const status = await response.json();
                updateStatus(status);
                log('Status refreshed', 'success');
            } catch (error) {
                log(`Error refreshing status: ${error.message}`, 'error');
            }
        }

        async function initScraper() {
            try {
                log('Initializing Java scraper...', 'info');
                const response = await fetch(`${API_BASE}/scraper/init`, { method: 'POST' });
                const result = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ ${result.message}`, 'success');
                    if (result.javaInstalled) {
                        log('‚úÖ Java installation verified', 'success');
                    }
                    if (result.dependenciesOk) {
                        log('‚úÖ All dependencies present', 'success');
                    }
                } else {
                    log(`‚ùå ${result.error}`, 'error');
                    if (result.missing) {
                        log(`Missing dependencies: ${result.missing.join(', ')}`, 'error');
                    }
                }
                await refreshStatus();
            } catch (error) {
                log(`Error initializing Java scraper: ${error.message}`, 'error');
            }
        }

        async function closeScraper() {
            try {
                log('Closing Java scraper...', 'info');
                const response = await fetch(`${API_BASE}/scraper/close`, { method: 'POST' });
                const result = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ ${result.message}`, 'success');
                } else {
                    log(`‚ùå ${result.error}`, 'error');
                }
                await refreshStatus();
            } catch (error) {
                log(`Error closing Java scraper: ${error.message}`, 'error');
            }
        }

        async function scrapeSet() {
            const setName = document.getElementById('setSelect').value;
            const isJapanese = document.getElementById('isJapanese').checked;
            
            if (!setName) {
                log('Please select a set to scrape', 'error');
                return;
            }

            try {
                log(`Starting Java scraper for set: ${setName} (${isJapanese ? 'Japanese' : 'English'})`, 'info');
                const response = await fetch(`${API_BASE}/scraper/set`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ setName, isJapanese })
                });
                const result = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ ${result.message}`, 'success');
                } else {
                    log(`‚ùå ${result.error}`, 'error');
                }
                await refreshStatus();
            } catch (error) {
                log(`Error scraping set with Java scraper: ${error.message}`, 'error');
            }
        }

        async function scrapeAllSets() {
            if (!confirm('This will scrape ALL sets and may take a very long time. Continue?')) {
                return;
            }

            try {
                log('Starting Java scraper for all sets...', 'info');
                const response = await fetch(`${API_BASE}/scraper/all`, { method: 'POST' });
                const result = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ ${result.message}`, 'success');
                } else {
                    log(`‚ùå ${result.error}`, 'error');
                }
                await refreshStatus();
            } catch (error) {
                log(`Error scraping all sets with Java scraper: ${error.message}`, 'error');
            }
        }

        async function syncData() {
            try {
                log('Syncing data to user collections...', 'info');
                const response = await fetch(`${API_BASE}/cards/sync`, { method: 'POST' });
                const result = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ ${result.message} - ${result.usersUpdated} users updated, ${result.cardsUpdated} cards updated`, 'success');
                } else {
                    log(`‚ùå ${result.error}`, 'error');
                }
            } catch (error) {
                log(`Error syncing data: ${error.message}`, 'error');
            }
        }

        async function loadSets() {
            const type = document.getElementById('setTypeFilter').value;
            
            try {
                const response = await fetch(`${API_BASE}/scraper/sets?type=${type}`);
                const data = await response.json();
                
                // Update set select dropdown
                const setSelect = document.getElementById('setSelect');
                setSelect.innerHTML = '<option value="">Select a set...</option>';
                data.sets.forEach(set => {
                    const option = document.createElement('option');
                    option.value = set.name;
                    option.textContent = `${set.name} (${set.type})`;
                    setSelect.appendChild(option);
                });
                
                // Update sets list
                const setsList = document.getElementById('setsList');
                setsList.innerHTML = data.sets.map(set => 
                    `${set.name} (${set.type})`
                ).join('\n');
                
                log(`Loaded ${data.total} sets (${data.englishCount} English, ${data.japaneseCount} Japanese)`, 'success');
            } catch (error) {
                log(`Error loading sets: ${error.message}`, 'error');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            loadSets();
            
            // Auto-refresh status every 10 seconds
            setInterval(refreshStatus, 10000);
        });
    </script>
</body>
</html>
